<script setup>
import TakeBonus from "./Header/TakeBonus.vue";
import { Link } from "@inertiajs/vue3";
import GameIcon from "@/icons/Header/Nav/game.vue";
import { ref, onMounted, watch } from "vue";
import { useUserStore } from "@/stores/userStore";
import NotifyList from "./Header/NotifyList.vue";

const userStore = useUserStore();
const isOpenNotify = ref(false);
const previousBalance = ref(0);
const isBalanceChanged = ref(false);
const isSlot = ref(false);
onMounted(() => {
    isSlot.value = window.location.pathname.includes('play/slot');
});

const toggleNotify = () => {
    isOpenNotify.value = !isOpenNotify.value;
};

watch(
    () => userStore.user?.balance,
    (newBalance, oldBalance) => {
        if (
            oldBalance !== undefined &&
            newBalance !== oldBalance &&
            oldBalance !== null
        ) {
            previousBalance.value = oldBalance;
            isBalanceChanged.value = true;

            // Reset animation after duration
            setTimeout(() => {
                isBalanceChanged.value = false;
            }, 1000);
        }
    },
    { immediate: true }
);
</script>

<template>
    <header>
        <div class="container flex justify-between items-center mx-auto h-full">
            <div class="max-md:hidden">
                <TakeBonus />
            </div>
            <img
                height="30"
                width="30"
                alt="logo"
                src="/assets/images/aside/test-logo.svg"
                class="md:hidden"
            />
            <div class="max-xl:hidden flex overflow-hidden gap-10 px-6 h-full">
                <Link href="/" class="nav-element">
                    <svg
                        width="24"
                        height="24"
                        viewBox="0 0 24 24"
                        fill="none"
                        xmlns="http://www.w3.org/2000/svg"
                    >
                        <path
                            d="M20.83 8.01002L14.28 2.77002C13 1.75002 11 1.74002 9.72996 2.76002L3.17996 8.01002C2.23996 8.76002 1.66996 10.26 1.86996 11.44L3.12996 18.98C3.41996 20.67 4.98996 22 6.69996 22H17.3C18.99 22 20.59 20.64 20.88 18.97L22.14 11.43C22.32 10.26 21.75 8.76002 20.83 8.01002ZM12.75 18C12.75 18.41 12.41 18.75 12 18.75C11.59 18.75 11.25 18.41 11.25 18V15C11.25 14.59 11.59 14.25 12 14.25C12.41 14.25 12.75 14.59 12.75 15V18Z"
                        />
                    </svg>

                    Home
                </Link>
                <Link href="/games" class="nav-element max-xl:hidden">
                    <GameIcon />
                    Games
                </Link>
                <Link href="/games?original_game" class="nav-element max-xl:hidden">
                    <svg
                        width="24"
                        height="24"
                        viewBox="0 0 24 24"
                        fill="none"
                        xmlns="http://www.w3.org/2000/svg"
                    >
                        <path
                            fill-rule="evenodd"
                            clip-rule="evenodd"
                            d="M14.2 11.0101C13.2854 12.847 12.8054 14.8854 12.8 16.9551V18.2588H8.08C8.08976 16.2107 8.5158 14.1881 9.33 12.3243C10.1924 10.3285 11.3276 8.47358 12.7 6.81732H5.7V3H18V5.02339C16.5394 6.87739 15.266 8.88358 14.2 11.0101ZM20.8 15.2446C20.0483 16.2377 19.5341 17.4032 19.3 18.6448L19.15 19.427L15 18.6343C15.4268 16.3497 16.6088 14.2938 18.34 12.8249L15.34 12.2095L16.6 9.43521L24 10.958L23.77 12.1678C22.6859 13.0896 21.6911 14.1201 20.8 15.2446ZM6.17 17.6748C5.88017 16.445 5.88017 15.1603 6.17 13.9305C6.51185 12.5041 6.9979 11.1196 7.62 9.80025L7.34 8.60082L0 10.4365V13.482L3 12.7415C2.00057 14.8344 1.74544 17.2293 2.28 19.5L6.35 18.457L6.17 17.6748Z"
                        />
                    </svg>

                    Slots
                </Link>
                <Link href="/account/bonus" class="nav-element">
                    <svg
                        width="24"
                        height="24"
                        viewBox="0 0 24 24"
                        fill="none"
                        xmlns="http://www.w3.org/2000/svg"
                    >
                        <path
                            d="M20 12V18C20 20.21 18.21 22 16 22H8C5.79 22 4 20.21 4 18V12C4 11.45 4.45 11 5 11H6.97C7.52 11 7.97 11.45 7.97 12V15.14C7.97 15.88 8.38 16.56 9.03 16.91C9.32 17.07 9.64 17.15 9.97 17.15C10.35 17.15 10.73 17.04 11.06 16.82L12.01 16.2L12.89 16.79C13.5 17.2 14.28 17.25 14.93 16.9C15.59 16.55 16 15.88 16 15.13V12C16 11.45 16.45 11 17 11H19C19.55 11 20 11.45 20 12Z"
                        />
                        <path
                            d="M21.5 7V8C21.5 9.1 20.97 10 19.5 10H4.5C2.97 10 2.5 9.1 2.5 8V7C2.5 5.9 2.97 5 4.5 5H19.5C20.97 5 21.5 5.9 21.5 7Z"
                        />
                        <path
                            d="M11.6398 5.00043H6.11978C5.77978 4.63043 5.78978 4.06043 6.14978 3.70043L7.56978 2.28043C7.93978 1.91043 8.54978 1.91043 8.91978 2.28043L11.6398 5.00043Z"
                        />
                        <path
                            d="M17.8696 5.00043H12.3496L15.0696 2.28043C15.4396 1.91043 16.0496 1.91043 16.4196 2.28043L17.8396 3.70043C18.1996 4.06043 18.2096 4.63043 17.8696 5.00043Z"
                        />
                        <path
                            d="M13.9704 11C14.5204 11 14.9704 11.45 14.9704 12V15.13C14.9704 15.93 14.0804 16.41 13.4204 15.96L12.5204 15.36C12.1904 15.14 11.7604 15.14 11.4204 15.36L10.4804 15.98C9.82043 16.42 8.94043 15.94 8.94043 15.15V12C8.94043 11.45 9.39043 11 9.94043 11H13.9704Z"
                        />
                    </svg>

                    Bonuses
                </Link>
                <Link href="/vip" class="nav-element active">
                    <svg
                        width="24"
                        height="24"
                        viewBox="0 0 24 24"
                        fill="none"
                        xmlns="http://www.w3.org/2000/svg"
                    >
                        <path
                            d="M22.0003 5.71048V15.2905C22.0003 18.0505 19.7603 20.2905 17.0003 20.2905H7.00031C6.54031 20.2905 6.10031 20.2305 5.67031 20.1105C5.05031 19.9405 4.85031 19.1505 5.31031 18.6905L15.9403 8.06048C16.1603 7.84048 16.4903 7.79048 16.8003 7.85048C17.1203 7.91048 17.4703 7.82048 17.7203 7.58048L20.2903 5.00048C21.2303 4.06048 22.0003 4.37048 22.0003 5.71048Z"
                            fill="#FF9429"
                        />
                        <path
                            d="M14.64 7.35953L4.17 17.8295C3.69 18.3095 2.89 18.1895 2.57 17.5895C2.2 16.9095 2 16.1195 2 15.2895V5.70953C2 4.36953 2.77 4.05953 3.71 4.99953L6.29 7.58953C6.68 7.96953 7.32 7.96953 7.71 7.58953L11.29 3.99953C11.68 3.60953 12.32 3.60953 12.71 3.99953L14.65 5.93953C15.03 6.32953 15.03 6.96953 14.64 7.35953Z"
                            fill="#FF9429"
                        />
                    </svg>

                    VIP Club
                </Link>
            </div>
            <div
                v-if="!userStore.isAuth"
                class="flex gap-4 items-center"
            >
                <Link class="text-[15px]" href="/login">Sign in</Link>
                <Link
                    href="/register"
                    class="btn btn-primary px-6 py-3 text-[15px]"
                    >Register</Link
                >
            </div>
            <div v-else class="flex relative gap-2 items-center">
                <div
                    class="border_angle bg-secondary-sidebar flex gap-4 items-center p-2 rounded-2xl"
                >
                    <Link href="/account/wallet" class="btn btn-green px-6"
                        >Deposit</Link
                    >
                    <div class="flex gap-3 items-center">
                        <div class="flex flex-col gap-1 items-end">
                            <p
                                class="text-secondary-light/50 text-nowrap text-sm font-medium leading-none"
                            >
                            Your balance

                            </p>
                            <p
                                class="text-nowrap text-base font-semibold leading-none transition-all duration-500"
                                :class="{
                                    'text-green-400 scale-110':
                                        isBalanceChanged,
                                    'text-white': !isBalanceChanged,
                                }"
                            >
                                {{ isSlot ? "In Play" :   "$" + (userStore.currentUser?.balance || "$0.00") }}
                            </p>
                        </div>
                        <Link href="/account/wallet" class="relative">
                            <img
                                src="/assets/images/header/default_avatar.png"
                                alt="avatar"
                                class="w-10 h-10 rounded-lg"
                            />
                        </Link>
                    </div>
                </div>
                <div
                    @click="toggleNotify"
                    class="notify-container-icon max-md:hidden flex-shrink-0 px-4 py-3.5 rounded-xl"
                >
                    <svg
                        v-if="userStore.user?.notifications_count > 0"
                        width="22"
                        height="27"
                        viewBox="0 0 22 27"
                        fill="none"
                        xmlns="http://www.w3.org/2000/svg"
                    >
                        <path
                            d="M16.7419 9.16315C15.9958 9.16315 15.3157 8.97548 14.7016 8.60013C14.0954 8.22478 13.6096 7.72166 13.2443 7.09076C12.879 6.45985 12.6963 5.76506 12.6963 5.00638C12.6963 4.2477 12.879 3.55291 13.2443 2.92201C13.6096 2.2911 14.0954 1.78798 14.7016 1.41263C15.3157 1.03728 15.9958 0.849609 16.7419 0.849609C17.4725 0.849609 18.1449 1.03728 18.7589 1.41263C19.3729 1.78798 19.8626 2.2911 20.2279 2.92201C20.5932 3.55291 20.7758 4.2477 20.7758 5.00638C20.7758 5.76506 20.5932 6.45985 20.2279 7.09076C19.8626 7.72166 19.3729 8.22478 18.7589 8.60013C18.1449 8.97548 17.4725 9.16315 16.7419 9.16315Z"
                            fill="#FF5353"
                        />
                        <path
                            fill-rule="evenodd"
                            clip-rule="evenodd"
                            d="M0.466349 20.9508C0.777248 21.2143 1.20862 21.3461 1.76047 21.3461H20.2395C20.7914 21.3461 21.2228 21.2143 21.5337 20.9508C21.8446 20.6872 22 20.3358 22 19.8966C22 19.4973 21.8873 19.11 21.6619 18.7346C21.4365 18.3593 21.1528 17.9919 20.8108 17.6326L19.8082 16.5544C19.5517 16.2829 19.3496 15.9275 19.2019 15.4883C19.062 15.049 18.9571 14.5819 18.8871 14.0867C18.8172 13.5916 18.7667 13.1124 18.7356 12.6492C18.7278 12.2579 18.7122 11.8786 18.6889 11.5112C18.6734 11.1359 18.6462 10.7725 18.6073 10.4211C18.312 10.5409 18.0088 10.6327 17.6979 10.6966C17.387 10.7605 17.0645 10.7924 16.7303 10.7924C15.6965 10.7924 14.7522 10.5329 13.8972 10.0138C13.05 9.48672 12.3699 8.78394 11.8569 7.90547C11.3517 7.027 11.0991 6.06068 11.0991 5.00651C11.0991 4.29575 11.2196 3.62092 11.4605 2.98203C11.7015 2.34314 12.0279 1.77214 12.4399 1.26901C12.0046 1.0454 11.5227 0.933594 10.9942 0.933594C10.1392 0.933594 9.42024 1.20512 8.83731 1.74818C8.25437 2.29123 7.85409 2.95408 7.63646 3.73672C6.60272 4.12005 5.76718 4.71901 5.12984 5.53359C4.50027 6.34818 4.0378 7.35443 3.74245 8.55234C3.44709 9.75026 3.28776 11.1159 3.26444 12.6492C3.23335 13.1124 3.18283 13.5916 3.11288 14.0867C3.04293 14.5819 2.93411 15.049 2.78643 15.4883C2.64653 15.9275 2.44833 16.2829 2.19184 16.5544C1.85762 16.9138 1.51952 17.2732 1.17753 17.6326C0.843314 17.9919 0.563505 18.3593 0.338103 18.7346C0.112701 19.11 0 19.4973 0 19.8966C0 20.3358 0.15545 20.6872 0.466349 20.9508ZM9.2337 25.7065C9.75446 26.002 10.3413 26.1497 10.9942 26.1497C11.6548 26.1497 12.2455 26.002 12.7663 25.7065C13.2871 25.411 13.7029 25.0237 14.0138 24.5445C14.3325 24.0654 14.519 23.5463 14.5734 22.9872H7.4266C7.47324 23.5463 7.65589 24.0654 7.97456 24.5445C8.29323 25.0237 8.71295 25.411 9.2337 25.7065Z"
                            fill="#2C3D7D"
                        />
                    </svg>
                    <svg
                        v-else
                        width="22"
                        height="27"
                        viewBox="0 0 22 27"
                        fill="none"
                        xmlns="http://www.w3.org/2000/svg"
                    >
                        <path
                            d="M16.7419 9.16315C15.9958 9.16315 15.3157 8.97548 14.7016 8.60013C14.0954 8.22478 13.6096 7.72166 13.2443 7.09076C12.879 6.45985 12.6963 5.76506 12.6963 5.00638C12.6963 4.2477 12.879 3.55291 13.2443 2.92201C13.6096 2.2911 14.0954 1.78798 14.7016 1.41263C15.3157 1.03728 15.9958 0.849609 16.7419 0.849609C17.4725 0.849609 18.1449 1.03728 18.7589 1.41263C19.3729 1.78798 19.8626 2.2911 20.2279 2.92201C20.5932 3.55291 20.7758 4.2477 20.7758 5.00638C20.7758 5.76506 20.5932 6.45985 20.2279 7.09076C19.8626 7.72166 19.3729 8.22478 18.7589 8.60013C18.1449 8.97548 17.4725 9.16315 16.7419 9.16315Z"
                            fill="#47F260"
                        />
                        <path
                            fill-rule="evenodd"
                            clip-rule="evenodd"
                            d="M0.466349 20.9505C0.777248 21.2141 1.20862 21.3458 1.76047 21.3458H20.2395C20.7914 21.3458 21.2228 21.2141 21.5337 20.9505C21.8446 20.687 22 20.3356 22 19.8964C22 19.4971 21.8873 19.1097 21.6619 18.7344C21.4365 18.359 21.1528 17.9917 20.8108 17.6323L19.8082 16.5542C19.5517 16.2827 19.3496 15.9273 19.2019 15.488C19.062 15.0488 18.9571 14.5816 18.8871 14.0865C18.8172 13.5913 18.7667 13.1122 18.7356 12.649C18.7278 12.2577 18.7122 11.8783 18.6889 11.511C18.6734 11.1356 18.6462 10.7722 18.6073 10.4208C18.312 10.5406 18.0088 10.6325 17.6979 10.6964C17.387 10.7603 17.0645 10.7922 16.7303 10.7922C15.6965 10.7922 14.7522 10.5327 13.8972 10.0136C13.05 9.48647 12.3699 8.7837 11.8569 7.90522C11.3517 7.02675 11.0991 6.06043 11.0991 5.00627C11.0991 4.2955 11.2196 3.62068 11.4605 2.98179C11.7015 2.3429 12.0279 1.77189 12.4399 1.26877C12.0046 1.04516 11.5227 0.93335 10.9942 0.93335C10.1392 0.93335 9.42024 1.20488 8.83731 1.74793C8.25437 2.29099 7.85409 2.95384 7.63646 3.73647C6.60272 4.11981 5.76718 4.71877 5.12984 5.53335C4.50027 6.34793 4.0378 7.35418 3.74245 8.5521C3.44709 9.75002 3.28776 11.1156 3.26444 12.649C3.23335 13.1122 3.18283 13.5913 3.11288 14.0865C3.04293 14.5816 2.93411 15.0488 2.78643 15.488C2.64653 15.9273 2.44833 16.2827 2.19184 16.5542C1.85762 16.9136 1.51952 17.2729 1.17753 17.6323C0.843314 17.9917 0.563505 18.359 0.338103 18.7344C0.112701 19.1097 0 19.4971 0 19.8964C0 20.3356 0.15545 20.687 0.466349 20.9505ZM9.2337 25.7063C9.75446 26.0018 10.3413 26.1495 10.9942 26.1495C11.6548 26.1495 12.2455 26.0018 12.7663 25.7063C13.2871 25.4108 13.7029 25.0235 14.0138 24.5443C14.3325 24.0651 14.519 23.546 14.5734 22.987H7.4266C7.47324 23.546 7.65589 24.0651 7.97456 24.5443C8.29323 25.0235 8.71295 25.4108 9.2337 25.7063Z"
                            fill="#2C3D7D"
                        />
                    </svg>
                </div>
                <NotifyList
                    :toggleNotify="toggleNotify"
                    :isOpenNotify="isOpenNotify"
                />
            </div>
        </div>
    </header>
</template>

<style scoped>
.notify-container-icon::before {
    content: "";
    position: absolute;
    bottom: -20px;
    left: 50%;
    transform: translateX(-50%);
    width: 37px;
    height: 20px;
    filter: blur(25px);
    background: #298aff;
}
.notify-container-icon {
    @apply h-full overflow-hidden relative cursor-pointer;
    border: 1px solid rgba(41, 138, 255, 0.25);
    backdrop-filter: blur(10px);
}
</style>
